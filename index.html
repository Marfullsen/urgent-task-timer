<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Left Time TTS</title>
</head>
<body>
    <main>
        <h1>Urgent Task Timer</h1>
        <article>
            <label for="frecuency"><h2>Let me know every:</h2></label>
            <select id="frecuency">
            <option value="1">1 min</option>
            <option value="5">5 min</option>
            <option value="10">10 min</option>
            <option value="15" selected>15 min</option>
            </select>
        </article>
        <br>
        <hr>
        <p>because</p>
        <hr>
        <br>
        <article>
            <h2>I have time only until</h2>
            <input id="till" type="time" value="00:00">
            <button onclick="fixed()" type="button">Start</button>
        </article>
        <br>
        <hr>
        <p>or</p>
        <hr>
        <br>
        <article>
            <label for="lapso"><h2>I have only:</h2></label>
            <select id="lapso">
            <option value="30">30 min</option>
            <option value="40">40 min</option>
            <option value="50">50 min</option>
            <option value="60" selected>1 hour</option>
            </select>
            <button onclick="setTimeout(lapso, 50);">Start</button>
        </article>
    </main>
    <script>
        const HOUR = 1 * 60 * 60 * 1000
        let now = new Date()
        let oneHourMore = new Date()

        oneHourMore.setTime(now.getTime() + HOUR)
        till.value = oneHourMore.toTimeString().slice(0, 5);

        function fixed() {
            let msg = 'fixed time. '
            msg += "Frecuency: " + frecuency.value + " minutes. "
            msg += "You have time only till" + till.value
            /* talk(msg) */

            now = new Date()

            const [hours, minutes] = till.value.split(':').map(Number);
            const till_time = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
            total_minutes_left = Math.floor(Math.abs(till_time - now) / 60_000);

            //let now_in_hours_minutes = now.toTimeString().slice(0, 5);
            let left_hours = Math.floor(total_minutes_left / 60) //till.value.split(':')[0] - now_in_hours_minutes.split(':')[0]
            let left_minutes = Math.floor(total_minutes_left % 60) //till.value.split(':')[1] - now_in_hours_minutes.split(':')[1]
            /* console.log(left_hours + 'HOUR'); */
            /* console.log(left_minutes + 'MIN'); */
            hour_or_plural = left_hours > 0 ? 'hours' : 'hour'
            minute_or_plural = left_minutes > 0 ? 'minutes' : 'minute'
            if (left_hours > 0 && left_minutes > 0) {
                talk('YOU HAVE ONLY ' + left_hours + ' ' + hour_or_plural + 'with' + left_minutes + ' ' + minute_or_plural)
            } else if (left_hours == 0 && left_minutes > 0){
                talk('YOU HAVE ONLY ' + left_minutes + minute_or_plural)
            } else if (left_hours > 0 && left_minutes == 0){
                talk('YOU HAVE ONLY ' + left_hours + hour_or_plural)
            } else {
                talk('You have runned out of time.')
            }
        }
        function lapso() {
            talk('lapse')
            talk(frecuency.value + " minutes")
        }
        if ('speechSynthesis' in window) {
            // Speech Synthesis supported ðŸŽ‰
            var msg = new SpeechSynthesisUtterance();

            function talk(msg_input) {
                msg.text = msg_input;
                window.speechSynthesis.speak(msg);
            }
        }else{
            // Speech Synthesis Not Supported ðŸ˜£
            alert("Sorry, your browser doesn't support text to speech!");
        }
    </script>
</body>
</html>